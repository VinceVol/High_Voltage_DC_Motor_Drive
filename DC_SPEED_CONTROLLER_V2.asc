Version 4.1
SHEET 1 2272 1660
WIRE 928 -1552 928 -1584
WIRE -928 -1456 -1088 -1456
WIRE -800 -1456 -928 -1456
WIRE -736 -1456 -800 -1456
WIRE 928 -1440 928 -1472
WIRE 928 -1440 912 -1440
WIRE 1440 -1408 1424 -1408
WIRE 1488 -1408 1440 -1408
WIRE 1632 -1408 1600 -1408
WIRE -1088 -1392 -1088 -1456
WIRE -928 -1392 -928 -1456
WIRE -800 -1392 -800 -1456
WIRE 416 -1392 384 -1392
WIRE 576 -1392 528 -1392
WIRE 592 -1392 576 -1392
WIRE 1440 -1376 1440 -1408
WIRE 1488 -1376 1472 -1376
WIRE 1632 -1376 1600 -1376
WIRE 416 -1360 384 -1360
WIRE 544 -1360 528 -1360
WIRE 576 -1360 576 -1392
WIRE 928 -1344 912 -1344
WIRE 928 -1312 928 -1344
WIRE 928 -1312 720 -1312
WIRE 1296 -1312 928 -1312
WIRE 1472 -1312 1472 -1376
WIRE 1472 -1312 1440 -1312
WIRE 544 -1296 544 -1360
WIRE 576 -1296 544 -1296
WIRE -1088 -1264 -1088 -1312
WIRE -960 -1264 -1088 -1264
WIRE -928 -1264 -928 -1328
WIRE -928 -1264 -960 -1264
WIRE -800 -1264 -800 -1312
WIRE -800 -1264 -928 -1264
WIRE 368 -1232 368 -1280
WIRE 400 -1232 368 -1232
WIRE 544 -1232 544 -1296
WIRE 544 -1232 528 -1232
WIRE 1472 -1232 1472 -1312
WIRE 1488 -1232 1472 -1232
WIRE 1648 -1232 1648 -1280
WIRE 1648 -1232 1616 -1232
WIRE -960 -1216 -960 -1264
WIRE -928 -1216 -960 -1216
WIRE 224 -1216 224 -1264
WIRE 224 -1216 96 -1216
WIRE 720 -1216 720 -1312
WIRE 1296 -1216 1296 -1312
WIRE 400 -1200 400 -1232
WIRE 416 -1200 400 -1200
WIRE 544 -1200 528 -1200
WIRE 560 -1200 544 -1200
WIRE 656 -1200 640 -1200
WIRE 1376 -1200 1360 -1200
WIRE 1472 -1200 1456 -1200
WIRE 1488 -1200 1472 -1200
WIRE 1616 -1200 1616 -1232
WIRE 1616 -1200 1600 -1200
WIRE -928 -1184 -928 -1216
WIRE 304 -1168 288 -1168
WIRE 416 -1168 384 -1168
WIRE 544 -1168 544 -1200
WIRE 544 -1168 528 -1168
WIRE 1472 -1168 1472 -1200
WIRE 1488 -1168 1472 -1168
WIRE 1728 -1168 1600 -1168
WIRE 1760 -1168 1728 -1168
WIRE 1856 -1168 1856 -1184
WIRE 1856 -1168 1840 -1168
WIRE 1728 -1152 1728 -1168
WIRE 96 -1136 96 -1216
WIRE 96 -1136 64 -1136
WIRE 160 -1136 96 -1136
WIRE 288 -1136 288 -1168
WIRE 288 -1136 256 -1136
WIRE 560 -1136 528 -1136
WIRE 720 -1136 720 -1184
WIRE 720 -1136 560 -1136
WIRE 1296 -1136 1296 -1184
WIRE 1456 -1136 1296 -1136
WIRE 1488 -1136 1456 -1136
WIRE 1456 -1120 1456 -1136
WIRE -144 -1104 -160 -1104
WIRE 64 -1104 64 -1136
WIRE 64 -1104 -64 -1104
WIRE 1856 -1104 1792 -1104
WIRE -992 -1072 -1024 -1072
WIRE 560 -1072 560 -1136
WIRE 208 -1056 208 -1072
WIRE 208 -1056 192 -1056
WIRE 720 -1056 720 -1136
WIRE 800 -1056 720 -1056
WIRE 928 -1056 880 -1056
WIRE 1040 -1056 1008 -1056
WIRE 1152 -1056 1120 -1056
WIRE 1296 -1056 1296 -1136
WIRE 1296 -1056 1232 -1056
WIRE 240 -1040 224 -1040
WIRE 368 -1040 336 -1040
WIRE 1856 -1040 1856 -1104
WIRE 368 -1024 368 -1040
WIRE -1024 -1008 -1024 -1072
WIRE -1024 -1008 -1104 -1008
WIRE -848 -1008 -1024 -1008
WIRE 1728 -1008 1728 -1056
WIRE -1104 -976 -1104 -1008
WIRE -848 -976 -848 -1008
WIRE -160 -976 -160 -1104
WIRE -144 -976 -160 -976
WIRE 48 -976 48 -1008
WIRE 48 -976 -64 -976
WIRE 80 -976 48 -976
WIRE 224 -976 224 -1040
WIRE 224 -976 192 -976
WIRE 1472 -944 1472 -992
WIRE 1488 -944 1472 -944
WIRE 1648 -944 1616 -944
WIRE 400 -928 368 -928
WIRE 544 -928 544 -992
WIRE 544 -928 528 -928
WIRE 1296 -928 1296 -1056
WIRE 288 -912 288 -976
WIRE 288 -912 272 -912
WIRE 720 -912 720 -1056
WIRE 1376 -912 1360 -912
WIRE 1472 -912 1456 -912
WIRE 1488 -912 1472 -912
WIRE 1616 -912 1616 -944
WIRE 1616 -912 1600 -912
WIRE 400 -896 400 -928
WIRE 416 -896 400 -896
WIRE 544 -896 528 -896
WIRE 560 -896 544 -896
WIRE 656 -896 640 -896
WIRE 1472 -880 1472 -912
WIRE 1488 -880 1472 -880
WIRE 1776 -880 1680 -880
WIRE 1856 -880 1856 -960
WIRE 1856 -880 1776 -880
WIRE 192 -864 192 -912
WIRE 192 -864 -32 -864
WIRE 256 -864 192 -864
WIRE 416 -864 320 -864
WIRE 544 -864 544 -896
WIRE 544 -864 528 -864
WIRE -1104 -848 -1104 -896
WIRE -848 -848 -848 -896
WIRE -160 -848 -160 -976
WIRE -144 -848 -160 -848
WIRE -32 -848 -32 -864
WIRE -32 -848 -64 -848
WIRE 1296 -848 1296 -896
WIRE 1488 -848 1296 -848
WIRE 720 -832 720 -880
WIRE 720 -832 528 -832
WIRE -32 -816 -32 -848
WIRE 80 -816 80 -896
WIRE 320 -816 320 -864
WIRE 320 -816 80 -816
WIRE 1776 -784 1776 -880
WIRE 80 -752 80 -816
WIRE 720 -752 720 -832
WIRE 1008 -752 720 -752
WIRE 1296 -752 1296 -848
WIRE 1296 -752 1008 -752
WIRE -160 -720 -160 -848
WIRE -32 -704 -32 -736
WIRE 16 -704 -32 -704
WIRE 416 -704 384 -704
WIRE 576 -704 528 -704
WIRE 720 -704 720 -752
WIRE 720 -704 576 -704
WIRE 416 -672 384 -672
WIRE 544 -672 528 -672
WIRE 576 -672 576 -704
WIRE -848 -624 -848 -768
WIRE 1008 -624 1008 -752
WIRE 80 -608 80 -656
WIRE 544 -608 544 -672
WIRE 576 -608 544 -608
WIRE 544 -576 544 -608
WIRE -848 -496 -848 -544
WIRE 656 -496 320 -496
WIRE 656 -480 656 -496
WIRE 128 -464 0 -464
WIRE 304 -464 288 -464
WIRE 320 -464 320 -496
WIRE 320 -464 304 -464
WIRE 0 -432 0 -464
WIRE 128 -432 112 -432
WIRE 304 -432 304 -464
WIRE 304 -432 288 -432
WIRE 128 -400 112 -400
WIRE 400 -400 288 -400
WIRE 528 -400 480 -400
WIRE 576 -400 528 -400
WIRE 656 -384 656 -400
WIRE 128 -368 112 -368
WIRE 304 -368 288 -368
WIRE 528 -320 528 -336
FLAG -1104 -848 0
FLAG -848 -496 0
FLAG -992 -1072 Vtorq
IOPIN -992 -1072 Out
FLAG -928 -1184 0
FLAG -736 -1456 Vangpos
IOPIN -736 -1456 Out
FLAG -160 -720 0
FLAG 560 -1072 1
FLAG 368 -1280 0
FLAG 368 -928 0
FLAG 1456 -1120 2
FLAG 1648 -1280 0
FLAG 1648 -944 0
FLAG 1008 -624 0
FLAG 256 -864 vdi
FLAG 1776 -784 vdi
FLAG 224 -1264 v_pwm
FLAG 1856 -1184 v_pwm
FLAG 1728 -928 0
FLAG 80 -608 0
FLAG 592 -1392 1
FLAG 1424 -1408 2
FLAG 48 -1008 v_log
FLAG 384 -1392 0
FLAG 384 -1360 v_log
FLAG 1632 -1408 0
FLAG 1632 -1376 v_log
FLAG 384 -704 0
FLAG 384 -672 v_log
FLAG 544 -576 vcl
FLAG 544 -992 vcl
FLAG 1472 -992 vcl
FLAG 928 -1584 0
FLAG 112 -432 in+
FLAG 112 -400 in-
FLAG 912 -1440 in+
FLAG 912 -1344 in-
FLAG 528 -320 0
FLAG -32 -624 0
FLAG 368 -1024 0
FLAG 304 -368 0
FLAG 0 -352 0
FLAG 656 -384 0
SYMBOL ind -864 -992 R0
SYMATTR InstName L1
SYMATTR Value 0.01
SYMATTR SpiceLine Rser=0
SYMBOL Res -864 -864 R0
SYMATTR InstName RB1
SYMATTR Value 0.002
SYMBOL voltage -848 -640 R0
WINDOW 0 -133 22 Left 2
SYMATTR InstName VSENSE2
SYMATTR Value 0
SYMBOL h -1104 -992 R0
WINDOW 123 24 118 Left 2
SYMATTR Value2 0.29
SYMATTR InstName H_TORQ1
SYMATTR Value VSENSE1
SYMBOL f -1088 -1312 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
WINDOW 123 24 -22 Left 2
SYMATTR InstName FPOS1
SYMATTR Value VSENSE2
SYMATTR Value2 1
SYMBOL Cap -944 -1392 R0
SYMATTR InstName CPOS1
SYMATTR Value 1
SYMBOL Res -816 -1408 R0
SYMATTR InstName RPOS1
SYMATTR Value 1Meg
SYMBOL voltage -48 -1104 R90
WINDOW 0 -10 55 Left 2
WINDOW 3 194 185 Right 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value PULSE(0 3.3 0 10ns 10ns 49us 50us)
SYMBOL voltage -48 -848 R90
WINDOW 0 15 56 VBottom 2
WINDOW 3 -3 208 Top 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value PULSE(0 3.3 0 20us 20us 2500ms 5000ms)
SYMBOL ind 784 -1072 M90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName LA2
SYMATTR Value 50µH
SYMATTR SpiceLine Rser=0
SYMBOL Res 912 -1072 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RA2
SYMATTR Value 0.5
SYMBOL voltage 1136 -1056 M90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName VSENSE1
SYMATTR Value 0
SYMBOL h 1024 -1056 M90
WINDOW 3 89 54 Left 2
WINDOW 123 90 78 Left 2
WINDOW 0 -45 95 VLeft 2
SYMATTR Value VSENSE2
SYMATTR Value2 0.29
SYMATTR InstName H_EMF2
SYMBOL res 656 -1216 R90
WINDOW 0 -1 79 VBottom 2
WINDOW 3 -28 39 VTop 2
SYMATTR InstName R1
SYMATTR Value 10
SYMBOL res 656 -912 R90
WINDOW 0 -1 79 VBottom 2
WINDOW 3 -28 39 VTop 2
SYMATTR InstName R5
SYMATTR Value 10
SYMBOL res 1360 -1216 M90
WINDOW 0 -1 79 VBottom 2
WINDOW 3 -28 39 VTop 2
SYMATTR InstName R7
SYMATTR Value 10
SYMBOL res 1360 -928 M90
WINDOW 0 -1 79 VBottom 2
WINDOW 3 -28 39 VTop 2
SYMATTR InstName R9
SYMATTR Value 10
SYMBOL res 1584 -896 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 100
SYMBOL voltage -48 -976 R90
WINDOW 0 14 57 VBottom 2
WINDOW 3 30 58 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value 5
SYMBOL npn 1792 -1152 M0
SYMATTR InstName Q2
SYMATTR Value 2N2222
SYMBOL res 1840 -1056 R0
SYMATTR InstName R8
SYMATTR Value 1K
SYMBOL npn 16 -752 R0
SYMATTR InstName Q3
SYMATTR Value 2N2222
SYMBOL res -48 -832 R0
SYMATTR InstName R2
SYMATTR Value 1K
SYMBOL res 400 -1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 100
SYMBOL res 1856 -1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 100
SYMBOL res 64 -992 R0
SYMATTR InstName R13
SYMATTR Value 1K
SYMBOL FOD3182 464 -1184 M180
SYMATTR InstName U9
SYMBOL FOD3182 464 -880 M180
SYMATTR InstName U2
SYMBOL FOD3182 1552 -1184 R180
SYMATTR InstName U3
SYMBOL FOD3182 1552 -896 R180
SYMATTR InstName U4
SYMBOL cap 560 -1360 R0
SYMATTR InstName C1
SYMATTR Value 0.1µ
SYMBOL SRS0515 448 -1376 M180
SYMATTR InstName U5
SYMBOL cap 1456 -1376 M0
SYMATTR InstName C2
SYMATTR Value 0.1µ
SYMBOL SRS0515 1568 -1392 R180
SYMATTR InstName U10
SYMBOL cap 560 -672 R0
SYMATTR InstName C3
SYMATTR Value 0.1µ
SYMBOL SRS0515 448 -688 M180
SYMATTR InstName U11
SYMBOL voltage 928 -1456 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value SINE(85 85 120)
SYMBOL res 384 -416 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 15K
SYMBOL cap 544 -400 M0
SYMATTR InstName C4
SYMATTR Value 0.005µ
SYMBOL res -48 -720 R0
SYMATTR InstName R18
SYMATTR Value 10K
SYMBOL irfb4227pbf 688 -1200 R0
SYMATTR InstName U14
SYMBOL irfb4227pbf 688 -896 R0
SYMATTR InstName U1
SYMBOL irfb4227pbf 1328 -912 M0
SYMATTR InstName U6
SYMBOL irfb4227pbf 1328 -1200 M0
SYMATTR InstName U7
SYMBOL pnp 256 -1072 M270
SYMATTR InstName Q1
SYMBOL npn 240 -976 R270
SYMATTR InstName Q4
SYMBOL res 176 -1072 R0
SYMATTR InstName R6
SYMATTR Value 1K
SYMBOL res 288 -928 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 1K
SYMBOL res 1712 -1024 R0
SYMATTR InstName R14
SYMATTR Value 1K
SYMBOL TMCS1126x7A 208 -416 R0
SYMATTR InstName U8
SYMBOL voltage 0 -448 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 2.5
SYMBOL voltage 656 -496 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
TEXT 632 -1664 Left 2 ;OptoIso Circuit
TEXT 640 -1632 Left 2 !.tran 5000ms
TEXT -1216 -1568 Left 2 ;F - current controlled current source\nI(VENSE2) - angular velocity modeled as current  (rad/sec)\nVoltage across CPOS - angular position modeled as voltage (rad)
TEXT -152 -896 Left 2 ;Direction
TEXT -168 -1152 Left 2 ;Speed (PWM)
TEXT -144 -1024 Left 2 ;V_Log_Lev
TEXT 640 -1600 Left 2 !.include FOD3182.lib
TEXT 640 -1696 Left 2 !.include irfb4227pbf.spi
