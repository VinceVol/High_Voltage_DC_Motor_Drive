* UNIQUE FOD3182 MACROMODEL
* Global Models
.MODEL nmos_fod nmos (vto=+0.7)
.MODEL nmosmod_fod nmos (vto=+0.5 RS=0.5 LAMBDA=0)
.MODEL npn_fod npn bf=16
.MODEL pnp_fod pnp bf=100 
.MODEL dmod_fod D IS=2.22P CJO=1P VJ=.376 M=.139 N=1.07
.MODEL lednor_fod D IS=5E-16 N=2 XTI=3 EG=2.1 BV=5 IBV=10u CJO=60p VJ=.75 M=.3333 FC=.5 TT=20n
.MODEL lednorc_fod D IS=5E-16 N=2 XTI=3 EG=2.1 BV=5 IBV=10u VJ=.75 M=.3333 FC=.5 

.subckt FOD3182 1 2 3 4 5 6 7 8 
* 1:NC, 2:Anode, 3:Cathode, 4:NC, 5:Vee, 6:Vo, 7:Vo, 8:Vcc
q2icc 163 84 8 pnp_fod
q1icc 84 84 8 pnp_fod
xled 5 10 3 2 led_fod
xlimitl 5 10 50 limitl_fod
ehdrive 42 7 40 5 1
eldrive 51 5 50 5 -1
xhlimit 5 10 40 limit_fod
vuvlo 20 5 DC 8.3
vccinside 22 5 DC 30
dmosl 5 7 dmod_fod
ddrive3 47 46 dmod_fod
ddrive2 49 47 dmod_fod
ddrive1 7 49 dmod_fod
q4icc 122 124 5 npn_fod
q3icc 84 122 124 npn_fod
qdrive3 8 46 47 npn_fod
qdrive2 8 47 49 npn_fod
qdrive1 8 49 48 npn_fod
xuvlo 5 22 8 21 23 comp_fod
muvlo 10 24 5 5 nmos_fod L=1e-6 W=100e-6
mdrive 7 52 5 5 nmosmod_fod L=1e-6 W=20e-3
cuvlo 24 5 20e-12
chigh 8 7 1e-12
clgate 52 5 1e-12
clow 7 5 1e-12
chgate 46 7 300e-12 
rshort67 6 7 0.0001
ruvlo2 23 21 40e3
r2icc 124 5 600
ruvlo3 23 24 1e3
r1icc 163 122 1e3
rhgate 42 46 1e3
rlgate 51 52 1e3
ruvlo 21 20 1e3
rehdrive 48 7 0.8  
.ends FOD3182

.subckt led_fod 1 3 4 5
gband 1 3 9 1 1 
fphoto 1 9 vsense 1 
egain 7 4 6 4 1
cband 3 1 140e-12
ithre 3 1 DC 500e-6
vsense 8 4 DC 0
dled 6 4 lednor_fod
doptic 7 8 lednorc_fod
rband 3 1 1e3 TC1=2e-3
rthermo 9 1 1 TC1=-1.5e-3
rled 5 6 1
.ends led_fod

.subckt limitl_fod 1 2 3
elimit 4 1 2 7 10
vnegativ 6 1 DC -12
vthreshold 7 1 DC 2
vpositive 5 1 DC 12
dnega 6 3 dmod_fod
dposi 3 5 dmod_fod
r2 4 3 1e3
r1 2 7 10e6
.ends limitl_fod

.subckt limit_fod 1 2 3
elimit 4 1 2 7 10
vnegativ 6 1 DC -10
vthreshold 7 1 DC 2
vpositive 5 1 DC 10
dnega 6 3 dmod_fod
dposi 3 5 dmod_fod
r2 4 3 1e3
r1 2 7 1e6
.ends limit_fod

.subckt comp_fod 1 2 3 4 5
mcopa 5 6 1 1 nmos_fod L=1e-6 W=100e-6
egain 6 1 3 4 1e3
ro 5 2 10e3
rgate 6 1 10e3
r1n 3 4 1e6
.ends comp_fod
